angular.module("hindsightinvesting.investments",[]),angular.module("hindsightinvesting.investments").factory("InvestmentsService",["$http",function(e){"use strict";return{getStockData:function(t){return e.get("http://localhost:8000/getIndividualStockData",{params:{stockTicker:t}}).success(function(e){e=e.substring(42,e.length)})}}}]),angular.module("hindsightinvesting.investments").controller("InvestmentsCtrl",["$scope","$window","InvestmentsService",function(e,t,n){"use strict";function s(t){return n.getStockData(t).then(function(t){return"Stock not found"==t.data?"Stock not found":JSON.parse(e.UTIL.csv2Json(t.data.slice(0,-1)))})}function a(t){g=[],f=[],D={};for(var n in t)t.hasOwnProperty(n)&&(g.push(t[n]["Adj Close"]),f.push(t[n].Date),D[u(r(t[n].Date))]=t[n]["Adj Close"]);g=g.reverse(),f=f.reverse(),p=o(f),x=l(p,new Date(e.formFields.date))}function o(e){for(var t=[],n=0;n<e.length;n++){var s=new Date(e[n]+"T00:00:00.000Z");t.push(s)}return t}function r(e){var t=new Date(e+"T00:00:00.000Z");return t}function i(e){var t=e.getDate().toString();1==t.length&&(t=[0,t].join(""));var n=(e.getMonth()+1).toString();1==n.length&&(n=[0,n].join(""));var s=e.getFullYear().toString();return[t,n,s].join("-")}function l(t,n){e.dateSelectionTooOldFlag=!1;var s,a=t.length,o=-new Date(0,0,0).valueOf(),r=0;for(s=0;s<t.length;++s)r=Math.abs(t[s]-n),o>r&&(a=s,o=r);return 0==a&&(e.dateSelectionTooOldFlag=!0,e.formFields.date=t[0]),a}function d(e){for(var t=new Date,n=0;n<e.length;++n)e[n].nearestDate<t&&(t=e[n].nearestDate);return t}function c(t,n){for(var s=u(t),a=[],o=[],r=0,l=new Date;l>s;){a.push(i(s)),r=0;for(var d=0;d<n.length;++d)s>=n[d].date&&(r+=n[d].sharesPurchased*n[d].datesAndValuesDictionary[s]);o.push(r),s=v(s,7)}e.data=[],e.labels=[],e.data.push(o),e.labels=m(a)}function u(e){var t=e.getDay()||7;return 1!==t&&e.setHours(-24*(t-1)),new Date(e.setHours(0,0,0,0))}function v(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n}function m(e){if(e.length>50)for(var t=Math.round(e.length/50),n=0;n<e.length;n++)n%t!==0&&(e[n]="");return e}function h(){e.currentValue=e.data[0].slice(-1)[0]?e.data[0].slice(-1)[0]:0}e.formFields={},e.formFields.stockTicker="GOOG",e.formFields.amount=500,e.formFields.date=new Date("2010-01-30T00:00:00.000Z"),e.maxDate=new Date,e.dateSelectionTooOldFlag=!1;var g=null,f=null,p=null,x=null,D=null;e.investments=[],e.totalInvested=0,e.currentValue=0,e.addInvestment=function(){s(e.formFields.stockTicker).then(function(n){if("Stock not found"==n)t.alert("Entry not valid because stock not found on Yahoo finance. Examples of valid choices include 'Goog', 'AAPL' and 'MSFT'.");else{e.totalInvested=e.totalInvested+e.formFields.amount,a(n);var s={name:e.formFields.stockTicker,date:e.formFields.date,nearestDate:p[x],amount:e.formFields.amount,sharesPurchased:e.formFields.amount/D[u(p[x])],adjCloseArray:g,datesArray:f,javaScriptDatesArray:p,nearestDateIndex:x,datesAndValuesDictionary:D,dateSelectionTooOldFlag:e.dateSelectionTooOldFlag,tickerDoesntExistFlag:!1};e.investments.push(s);var o=d(e.investments);c(o,e.investments),h()}e.formFields.stockTicker="GOOG",e.formFields.amount=500})},e.removeInvestment=function(t){e.totalInvested=e.totalInvested-e.investments[t].amount,e.investments.splice(t,1);var n=d(e.investments);c(n,e.investments),h()},e.chartOptions={bezierCurve:!1,pointDot:!1,animation:!1,scaleShowHorizontalLines:!1,scaleShowVerticalLines:!1,showTooltips:!1},e.series=["Portfolio Value"],e.testJson=[{Date:"2016-09-26",Open:"31.690001",High:"31.709999",Low:"30.51",Close:"30.790001",Volume:"33991200","Adj Close":"100"},{Date:"2016-09-19",Open:"31.690001",High:"31.709999",Low:"30.51",Close:"37.790001",Volume:"33991200","Adj Close":"100"},{Date:"2016-09-12",Open:"31.690001",High:"31.709999",Low:"30.51",Close:"50.790001",Volume:"33991200","Adj Close":"100"},{Date:"2016-09-05",Open:"31.690001",High:"31.709999",Low:"30.51",Close:"32.790001",Volume:"33991200","Adj Close":"100"}]}]);var app=angular.module("hindsightinvesting",["ui.bootstrap","ngRoute","chart.js","hindsightinvesting.investments","ngMaterial"]).config(["$routeProvider",function(e){"use strict";e.when("/investments",{controller:"InvestmentsCtrl",templateUrl:"/hindsightinvesting/investments/investments.html"}).otherwise({redirectTo:"/investments"})}]);app.run(["$rootScope",function(e){e.UTIL={toFilename:function(e){return e.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")},fromFilename:function(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")},csv2Json:function(e){function t(e,t){t=t||",";for(var n=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),s=[[]],a=null;a=n.exec(e);){var o=a[1];if(o.length&&o!=t&&s.push([]),a[2])var r=a[2].replace(new RegExp('""',"g"),'"');else var r=a[3];s[s.length-1].push(r)}return s}for(var n=t(e),s=[],a=1;a<n.length;a++){s[a-1]={};for(var o=0;o<n[0].length&&o<n[a].length;o++){var r=n[0][o];s[a-1][r]=n[a][o]}}var i=JSON.stringify(s),l=i.replace(/},/g,"},\r\n");return l},csvToArray:function(e,t){t=t||",";for(var n=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),s=[[]],a=null;a=n.exec(e);){var o=a[1];if(o.length&&o!=t&&s.push([]),a[2])var r=a[2].replace(new RegExp('""',"g"),'"');else var r=a[3];s[s.length-1].push(r)}return s}}}]),function(e){try{e=angular.module("hindsightinvesting")}catch(t){e=angular.module("hindsightinvesting",[])}e.run(["$templateCache",function(e){e.put("/hindsightinvesting/investments/investments.html",'<div class="col-xs-12" style="height:30px"></div><div class="row"><div class="col-xs-offset-2 col-xs-2 text-center"><strong>Total Invested</strong></div><div class="col-xs-offset-4 col-xs-2 text-center"><strong>Value Today</strong></div></div><div class="row"><div class="col-xs-offset-2 col-xs-2 text-center img-rounded" style="border: 2px solid">${{totalInvested}}</div><div class="col-xs-offset-4 col-xs-2 text-center img-rounded" style="border: 2px solid">${{currentValue}}</div></div><div class="col-xs-12" style="height:30px"></div><div class="row"><div class="col-xs-offset-1 col-xs-10 text-center img-rounded" style="border: 2px solid"><canvas id="line" class="chart chart-line" chart-data="data" chart-labels="labels" chart-legend="true" chart-series="series" chart-click="onClick" chart-options="chartOptions"></canvas></div></div><div class="col-xs-12" style="height:30px"></div><div class="row"><div class="col-xs-offset-1 col-xs-10 text-center img-rounded" style="border: 2px solid"><table class="table"><thead><tr><th>Stock Name</th><th>Date of Purchase</th><th>Amount(EURO)</th><th></th></tr></thead><tbody><tr><form novalidate class="simple-form"><td><input ng-model="formFields.stockTicker"><br></td><td><md-datepicker ng-model="formFields.date" md-placeholder="Enter date" md-max-date="maxDate"></md-datepicker></td><td><input type="number" ng-model="formFields.amount"><br></td><td><input class="btn btn-primary" type="submit" ng-click="addInvestment()" ng-disabled="formFields.stockTicker.length==0 || formFields.date.length==0 || formFields.amount.length==0" value="Add Investment"></td></form></tr><tr ng-repeat="investment in investments"><td>{{investment.name}}</td><td>{{investment.date | date:\'dd-MM-yyyy\'}}<h6 class="text-warning">{{investment.dateSelectionTooOldFlag ? \'Date may predate Yahoo data for stock.\' : \'\'}}</h6><h6 class="text-warning">{{investment.dateSelectionTooOldFlag ? \'Defaulting to earliest available date.\' : \'\'}}</h6></td><td>{{investment.amount}}</td><td><button type="button" class="btn btn-primary" ng-click="removeInvestment($index)">Remove Investment</button></td></tr></tbody></table></div></div>')}])}();